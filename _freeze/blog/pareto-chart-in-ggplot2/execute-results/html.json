{
  "hash": "c4c903f58c736533d5f2aac9acf359ce",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Pareto Chart in ggplot2\"\ndate: \"24 March 2018\"\ndate-modified: '12 June 2024'\ncategories:\n  - R tips\n  - ggplot2\n  - base R\nauthor: Gary Hutson\nsubtitle: >\n  \"These charts are highly utilised in Six Sigma circles and conform to the Pareto Principle.\"\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n```\n:::\n\n\n# Background of Pareto Charts\n\nA Pareto chart, named after [Vilfredo Pareto](https://en.wikipedia.org/wiki/Vilfredo_Pareto), is a type of chart that contains both bars and a line graph, where individual values are represented in descending order by bars, and the cumulative total is represented by the line.\n\nThese charts are highly utilised in Six Sigma circles and conform to the [Pareto Principle](https://www.youtube.com/watch?v=F-I-BVqMiNI). The construction of the tool, in R, is shown in the following post.\n\n# Creating the R Data Frame\n\nTo create the R data frame we can use the following code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncount <- c(300, 430, 500, 320, 321, 543)\nxVariable <- c(\"Nottingham\", \"Bristol\", \"Leeds\", \"Keswick\", \"Derby\", \"Norfolk\")\n```\n:::\n\n\nThis creates two vectors using the combine function (denoted with a c). These two code lines are run in by either selecting the code blocks and using the Run command in R Studio, or by using the key combination of `Control + Enter`.\n\nNext, the data frame will be created:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyDf <- data.frame(\n  count = count,\n  UKCity = xVariable,\n  stringsAsFactors = FALSE\n)\n```\n:::\n\n\nThis creates a data frame called `myDf` and uses the data.frame command to create a data frame with two fields, one named count using the count vector and another named `UKCity` using the `xVariable` vector.\n\n# Adding the Pareto components\n\nThus far, we have simply created a data frame with two columns. The next step will be to sort the categorical variable (`UKCity`) by the count associated with that field, so the highest counts will be grouped first on the Pareto Chart and we will add a cumulative statistic to the data frame in order to draw the traditional Pareto cumulative sum line.\n\n# Performing the descending sort\n\nThe R code here shows how to do the descending sort:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyDf <- myDf[order(myDf$count, decreasing = TRUE), ]\n```\n:::\n\n\nWhat this does is uses the `myDf` data frame and then changes the order of the counts to show a decreasing count. This will put the highest counts at the top and the lowest at the bottom of the dataset. You could change the decreasing to `FALSE`, and this would force an ascending order.\n\n# Converting the categorical variable to a factor\n\nWe use the add field notation of `$` (dollar) to add a new column to the data frame:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyDf$UKCity <- factor(myDf$UKCity, levels = myDf$UKCity)\n```\n:::\n\n\nThis says use the `myDf` data frame and overwrite the existing `column = UKCity`. Then, create a unique factor for each of those categorical variables, so if you had repeating categories say three cities that equalled Nottingham, this would show as just one factor instead of three. This is a way to group multiple categorical variables together. The `levels =` command specifies what levels to set the factor to.\n\nAdding a cumulative sum to the data frame\n\nThis is simple: taking the count field we add each of the counts together to form a cumulative total:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyDf$cumulative <- cumsum(myDf$count)\n```\n:::\n\n\nThe code block shows that a field called cumulative has been added to the data frame (myDf) and the `cumsumfunction` has been used to create that cumulative total.\n\nThe data frame now looks like this:\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"dshucyhucg\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#dshucyhucg table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#dshucyhucg thead, #dshucyhucg tbody, #dshucyhucg tfoot, #dshucyhucg tr, #dshucyhucg td, #dshucyhucg th {\n  border-style: none;\n}\n\n#dshucyhucg p {\n  margin: 0;\n  padding: 0;\n}\n\n#dshucyhucg .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#dshucyhucg .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#dshucyhucg .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#dshucyhucg .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#dshucyhucg .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#dshucyhucg .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dshucyhucg .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#dshucyhucg .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#dshucyhucg .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#dshucyhucg .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#dshucyhucg .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#dshucyhucg .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#dshucyhucg .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#dshucyhucg .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#dshucyhucg .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#dshucyhucg .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#dshucyhucg .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#dshucyhucg .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#dshucyhucg .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dshucyhucg .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#dshucyhucg .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#dshucyhucg .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#dshucyhucg .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dshucyhucg .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#dshucyhucg .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#dshucyhucg .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dshucyhucg .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dshucyhucg .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#dshucyhucg .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dshucyhucg .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#dshucyhucg .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dshucyhucg .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#dshucyhucg .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dshucyhucg .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#dshucyhucg .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dshucyhucg .gt_left {\n  text-align: left;\n}\n\n#dshucyhucg .gt_center {\n  text-align: center;\n}\n\n#dshucyhucg .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#dshucyhucg .gt_font_normal {\n  font-weight: normal;\n}\n\n#dshucyhucg .gt_font_bold {\n  font-weight: bold;\n}\n\n#dshucyhucg .gt_font_italic {\n  font-style: italic;\n}\n\n#dshucyhucg .gt_super {\n  font-size: 65%;\n}\n\n#dshucyhucg .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#dshucyhucg .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#dshucyhucg .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#dshucyhucg .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#dshucyhucg .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#dshucyhucg .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#dshucyhucg .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#dshucyhucg .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#dshucyhucg div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"count\">count</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"UKCity\">UKCity</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"cumulative\">cumulative</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"count\" class=\"gt_row gt_right\">543</td>\n<td headers=\"UKCity\" class=\"gt_row gt_center\">Norfolk</td>\n<td headers=\"cumulative\" class=\"gt_row gt_right\">543</td></tr>\n    <tr><td headers=\"count\" class=\"gt_row gt_right\">500</td>\n<td headers=\"UKCity\" class=\"gt_row gt_center\">Leeds</td>\n<td headers=\"cumulative\" class=\"gt_row gt_right\">1043</td></tr>\n    <tr><td headers=\"count\" class=\"gt_row gt_right\">430</td>\n<td headers=\"UKCity\" class=\"gt_row gt_center\">Bristol</td>\n<td headers=\"cumulative\" class=\"gt_row gt_right\">1473</td></tr>\n    <tr><td headers=\"count\" class=\"gt_row gt_right\">321</td>\n<td headers=\"UKCity\" class=\"gt_row gt_center\">Derby</td>\n<td headers=\"cumulative\" class=\"gt_row gt_right\">1794</td></tr>\n    <tr><td headers=\"count\" class=\"gt_row gt_right\">320</td>\n<td headers=\"UKCity\" class=\"gt_row gt_center\">Keswick</td>\n<td headers=\"cumulative\" class=\"gt_row gt_right\">2114</td></tr>\n    <tr><td headers=\"count\" class=\"gt_row gt_right\">300</td>\n<td headers=\"UKCity\" class=\"gt_row gt_center\">Nottingham</td>\n<td headers=\"cumulative\" class=\"gt_row gt_right\">2414</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nIn terms of data preparation, everything is now in place to start working with {ggplot2}.\n\n# Creating the Pareto Chart (with ggplot2)\n\nThe following code with be included in full, followed by an explanation of what the code is doing:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nggplot(myDf, aes(x = myDf$UKCity)) +\n  geom_bar(aes(y = myDf$count), fill = \"blue\", stat = \"identity\") +\n  geom_point(aes(y = myDf$cumulative), color = rgb(0, 1, 0), pch = 16, size = 1) +\n  geom_path(aes(y = myDf$cumulative, group = 1), colour = \"slateblue1\", lty = 3, size = 0.9) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.6)) +\n  labs(\n    title = \"Pareto Plot\", subtitle = \"Produced by Gary Hutson\", x = \"UK Cities\", y =\n      \"Count\"\n  )\n```\n:::\n\n\nFully explained: the library for {ggplot} is loaded into the current environment. Secondly, the {ggplot} function is used to specify the data and the aesthetics of the column to be used. This is then added to specify a bar chart (geom_bar) using the count field (y axis) and filling the bars with the colour blue.\n\nThe purpose of the `stat = \"identity\"` is to force {ggplot} to identify the count field stipulated on the y axis. Again, the bar is then added to a point geometry (geom_point) and the point is the cumulative total we calculated with the colour defined using an RGB value, with the point type (pch) equal to a circle.\n\nThen, the geom_path function is used to add a path to the points and to specify what data type to group to, this is normally defaulted to `group = 1`.\n\nFinally, the last part is to apply a custom theme to specify that the element_text should be at a 90 degree angle and the vertical justification equal to 0.6.\n\nRunning this code produces the Pareto plot, as below:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](pareto-chart-in-ggplot2_files/figure-html/plot-1.png){width=672}\n:::\n:::\n\n\nThat's it, we now have an excellent looking chart that can be reproduced every time R is refreshed.\n\nThis blog was written by Gary Hutson, Principal Analyst, Activity & Access Team, Information & Insight at Nottingham University Hospitals NHS Trust, and was originally posted at [Hutson-Hacks](http://hutsons-hacks.info/pareto-chart-in-ggplot2).\n\nThis blog has been edited for [NHS-R Style](https://nhsrway.nhsrcommunity.com/style-guides.html#referencing-r-packages-and-functions-in-text).\n\n",
    "supporting": [
      "pareto-chart-in-ggplot2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}