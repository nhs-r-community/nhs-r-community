{
  "hash": "d6eb3bbfb22e2bc0e255dc4a0516cb4c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Diverging Dot Plot and Lollipop Charts – Plotting Variance with ggplot2\"\ndate: \"24 May 2018\"\ndate-modified: \"22 February 2024\"\ncategories:\n  - R tips\n  - ggplot2\n  - Base R\nauthor: Gary Hutson\nsubtitle: >\n  \"The aim here is to create a diverging bar chart that shows variance above and below an average line.\"\n---\n\n\n# Creating the Dot Plot Variance chart\n\nThe data preparation was used in the previous blog entitled: [Diverging Bar Charts – Plotting Variance with ggplot2](https://nhsrcommunity.com/diverging-bar-charts-plotting-variance-with-ggplot2).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 20240222 Added for qmd to run\nlibrary(ggplot2)\ntheme_set(theme_classic())\ndata(\"mtcars\") # load data\n\nmtcars$CarBrand <- rownames(mtcars) # Create new column for car brands and names\n\nmtcars$mpg_z_score <- round((mtcars$mpg - mean(mtcars$mpg))/sd(mtcars$mpg), digits=2)\n\nmtcars$mpg_type <- ifelse(mtcars$mpg_z_score <= 0, \"below\", \"above\")\n\nmtcars <- mtcars[order(mtcars$mpg_z_score), ] #Ascending sort on Z Score\nmtcars$CarBrand <- factor(mtcars$CarBrand, levels = mtcars$CarBrand)\n```\n:::\n\n\nRefer to that if you need to know how to create the data prior to this tutorial.\n\n# Setting up the Dot Plot Variance chart\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nggplot(mtcars, aes(x=CarBrand, y=mpg_z_score, label=mpg_z_score)) +\n  geom_point(stat='identity', aes(col=mpg_type), size=6) +\n  scale_color_manual(name=\"Mileage (deviation)\",\n                     labels = c(\"Above Average\", \"Below Average\"),\n                     values = c(\"above\"=\"#00ba38\", \"below\"=\"#0b8fd3\")) +\n  geom_text(color=\"white\", size=2) +\n  labs(title=\"Diverging Dot Plot (ggplot2)\",\n       subtitle=\"Z score showing Normalised mileage\", caption=\"Produced by Gary Hutson\") +\n  ylim(-2.5, 2.5) +\n  coord_flip()\n```\n:::\n\n\n\nThis is very similar to the previous plot we created in the previous post, however there are a few differences. The main difference is that we use a `geom_point()` geometry and set the colour of the points based on whether the said point deviates above and below the average. In addition, we use the `geom_text()` to set the colour of the text in the points to white and specify the size of the text. The final difference is that I have added a Y limit (`ylim`) range of -2.5 standard deviation to positive 2.5 standard deviations.\n\nRunning this block of code, along with the data preparation code, will give you a chart that looks as below:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](diverging-dot-plot-and-lollipop-charts-plotting-variance-with-ggplot2_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n# Creating the Diverging Lollipop Chart\n\nThe code below shows how to build the diverging lollipop chart in R and ggplot2:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mtcars, aes(x=CarBrand, y=mpg_z_score, label=mpg_z_score)) +\n  geom_point(stat='identity', aes(col=mpg_type), size=6) +\n  scale_color_manual(name=\"Mileage (deviation)\",\n                     labels = c(\"Above Average\", \"Below Average\"),\n                     values = c(\"above\"=\"#00ba38\", \"below\"=\"#0b8fd3\")) +\n  geom_segment(aes(y = 0,\n                   x = CarBrand,\n                   yend = mpg_z_score,\n                   xend = CarBrand),\n               color = \"black\") +\n  geom_text(color=\"white\", size=2) +\n  labs(title=\"Diverging Lollipop Chart\",\n       subtitle=\"Z score for normalised mileage\",\n       caption=\"Produced by Gary Hutson\") +\n  ylim(-2.5, 2.5) + coord_flip() + theme(panel.grid.major = element_blank(), panel.grid.minor =\n  element_blank())\n```\n:::\n\n\nSimilar geometries are used here. What has been added here is the <b>geom_segment()</b> this shows how the line segments need to be added. The starting y is equal to 0 on the Y scale and the starting x is the first car by the car brand. Similarly, the end of the x (`xend`) is also the CarBrand.\n\nThe only other difference is to add a theme constraint to the end of the code to turn off the major and minor grid lines, this is achieved by setting the `panel.grid.major` and `panel.grid.minor` equal to `element_blank()`.\n\nThe completed graph and plot is shown below:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](diverging-dot-plot-and-lollipop-charts-plotting-variance-with-ggplot2_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\nThere – we now have some lovely looking charts that can be put into a report to report on variance between categorical variables.\n\nThis blog was written by Gary Hutson, Principal Analyst, Activity & Access Team, Information & Insight at Nottingham University Hospitals NHS Trust, and was originally posted at [Hutsons-Hacks](https://hutsons-hacks.info/diverging-dot-plot-and-lollipop-charts-plotting-variance-with-ggplot2).\n",
    "supporting": [
      "diverging-dot-plot-and-lollipop-charts-plotting-variance-with-ggplot2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}