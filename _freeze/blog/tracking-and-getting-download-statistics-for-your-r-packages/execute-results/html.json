{
  "hash": "d0c1b877cd1b8e1e8cdc092ac9b37de6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tracking and getting download statistics for your R packages\"\ndate: \"8 September 2021\"\ndate-modified: \"19 July 2024\"\ncategories:\n  - Packages\n  - Functions\n  - Lists\n  - tidyverse\nauthor: Gary Hutson\nsubtitle: >\n---\n\nI had the privilege of tapping into the R package funding stream to fund my first, and not last, CRAN package entitled [NHSDataDictionaRy](https://cran.r-project.org/web/packages/NHSDataDictionaRy/vignettes/introduction.html).\n\nThe motivation for the package was to provide a consistent way to scrape the live NHS Data Dictionary website. The aim was to allow the lookups to always be up to date and to allow R users in the NHS to quickly get key NHS and medical lookup and reference files. This package also provides other generic web scraping functions that can be utilised with other websites.\n\nSlight digression – if you have a package idea that you think needs to be developed, then please fill in an NHS-R package [proforma](https://nhsrcommunity.com/nhs-r-solutions/) to put your proposal to the central team at NHS-R for consideration.\n\n### **Who is using my package?**\n\nThe motivation for this quick package wrapper was to find a way to track how often my package had been downloaded from CRAN, as I am a statistician by trade and have also worked in performance analysis, so I like to monitor the downloads from a sanity and return on investment viewpoint. In addition, I am rather curious to know if the package is being successful.\n\nThe first thing to do is to load the {**dlstats}** library in to my simple wrapper function to allow for the packages to be summarised in terms of downloads per month and to date. The package list creates three components in the R list, these are:\n\n1.  Plot of downloads over time\n\n2.  A [tibble](https://tibble.tidyverse.org/) (a fancy tidy data frame) of the downloads per package per month, if multiple packages are passed to the vector then you will get multiple results you can interrogate\n\n3.  Downloads_to_date this is a summary of all the downloads to date\n\n### **Creating the function wrapper**\n\nThe function wrapper looks as below:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load these libraries\nlibrary(ggplot2)\nlibrary(dlstats)\nlibrary(tibble)\n\n# Create the wrapper function\npackage_trackeR <- function(packages) {\n  # Create the downloads for the package\n  dl <- dlstats::cran_stats(c(packages))\n  # Create the plot\n  plot <- ggplot(\n    dl,\n    aes(end, downloads, group = package)\n  ) +\n    geom_line(aes(color = package), linetype = \"dashed\") +\n    geom_point(aes(shape = package, color = package)) +\n    theme_minimal()\n  plot <- plot + xlab(\"Download date\") +\n    ylab(\"Number of downloads\")\n  # Create a list for multiple returns\n  returns_list <- list(\n    \"download_df\" = as_tibble(dl),\n    \"downloads_to_date\" = sum(dl$downloads),\n    \"downloads_plot\" = plot\n  )\n\n  return(returns_list)\n}\n```\n:::\n\n\nTo decompose what this is doing:\n\n-   The **dl** variable uses the {[**dlstats**](https://cran.r-project.org/web/packages/dlstats/index.html)**}** package to download a vector of packages. The vector is denoted by the \\`c()\\` wrapper, this just allows you to pass multiple packages (as string inputs) to the function\n\n-   The plot creates a plot of all the downloads for the chosen package(s) and displays them on a line chart.\n\n-   The output of this returns the artefacts as stated in the precursory section.\n\n### **Using the function**\n\nTo use, or call, the new function we instantiate or utilise it, as below:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Call the new function\ntracking <- package_trackeR(c(\"NHSDataDictionaRy\"))\n```\n:::\n\n\nI simply now pass my vector of packages to the function and this returns the following associated outputs.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntracking$download_df\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 54 × 4\n   start      end        downloads package          \n   <date>     <date>         <int> <fct>            \n 1 2021-01-01 2021-01-31       129 NHSDataDictionaRy\n 2 2021-02-01 2021-02-28       526 NHSDataDictionaRy\n 3 2021-03-01 2021-03-31       502 NHSDataDictionaRy\n 4 2021-04-01 2021-04-30       155 NHSDataDictionaRy\n 5 2021-05-01 2021-05-31       484 NHSDataDictionaRy\n 6 2021-06-01 2021-06-30       452 NHSDataDictionaRy\n 7 2021-07-01 2021-07-31       571 NHSDataDictionaRy\n 8 2021-08-01 2021-08-31       529 NHSDataDictionaRy\n 9 2021-09-01 2021-09-30       369 NHSDataDictionaRy\n10 2021-10-01 2021-10-31       546 NHSDataDictionaRy\n# ℹ 44 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\ntracking$downloads_plot\n```\n\n::: {.cell-output-display}\n![](tracking-and-getting-download-statistics-for-your-r-packages_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\ntracking$downloads_to_date\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 15825\n```\n\n\n:::\n:::\n\n\n### **To close…**\n\nI hope this simple wrapper can be useful for tracking your packages when they get to CRAN and provide some much needed reassurance that what you are developing is being used *in the wild*.\n",
    "supporting": [
      "tracking-and-getting-download-statistics-for-your-r-packages_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}