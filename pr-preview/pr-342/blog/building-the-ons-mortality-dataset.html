<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Zoë Turner">
<meta name="dcterms.date" content="2020-04-23">
<title>Building the ONS mortality dataset – NHS-R Community Quarto website</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//img/nhsr-logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-cb0f9a82e1023f244a0f182ddea879de.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-35642e26c351337f658a1f8866735c73.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-cb0f9a82e1023f244a0f182ddea879de.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../site_libs/quarto-contrib/iconify-2.1.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1T1K3D1BKL"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-1T1K3D1BKL', { 'anonymize_ip': true});
</script><link rel="stylesheet" href="../assets/nhsr.css">
</head>
<body class="nav-fixed fullcontent quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://nhsrcommunity.com/" class="navbar-brand navbar-brand-logo">
    <img src="https://raw.githubusercontent.com/nhs-r-community/assets/main/logo/nhsr-logo.png" alt="NHS-R Community Logo which consists of the words and incorporating the R logo" class="navbar-logo"></a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../contact.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../events.html"> 
<span class="menu-text">Events</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../conference24.html"> 
<span class="menu-text">conference</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../books/index.html"> 
<span class="menu-text">Books</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog/index.html"> 
<span class="menu-text">Blogs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../packages.html"> 
<span class="menu-text">R Packages</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../getting-started.html"> 
<span class="menu-text">Getting Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../get-involved.html"> 
<span class="menu-text">Get Involved</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../fellowship.html"> 
<span class="menu-text">Fellowships</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../nlp.html"> 
<span class="menu-text">NLP</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/nhs-r-community" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns"><div id="title-block-header-title" class="quarto-title page-columns page-full page-layout-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);">
<h1 class="title">Building the ONS mortality dataset</h1>
<p class="subtitle lead">Taking the data from a wide format spreadsheet to a tidy long table</p>
    <div class="quarto-categories">
        <div class="quarto-category">Data</div>
        <div class="quarto-category">Packages</div>
        <div class="quarto-category">Training</div>
        <div class="quarto-category">dplyr</div>
        <div class="quarto-category">Functions</div>
        <div class="quarto-category">Loops</div>
        <div class="quarto-category">Web scraping</div>
      </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zoë Turner </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 23, 2020</p>
    </div>
  </div>
  
    
  </div>
  



</header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><!-- source: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/_partials/title-block-link-buttons/title-block.html --><!--
<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
--><!-- <header id="title-block-header" class="quarto-title-block default page-columns"> --><!-- <div class="quarto-title page-columns page-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);"> --><p>This blog was originally a vignette for the NHSRdatasets package that I wrote when I had only been using R for about a year and I found myself contributing to a package! I produced this vignette which detailed all the laborious steps I took to take the wide data sets for provisionally recorded deaths up to 2019 and made them long form.</p>
<p>I had been using these spreadsheets regularly for a mortality report in the Trust I worked in, but this data became incredibly important from 2020 (as well as changed format yet again) and so I’m sure there are better way to clean it and would be much easier to find than it was back before 2020. For the sake of transparency and showing how code changes over time I’m going to share it in its original state here and perhaps it can be its own training challenge as you free to improve or correct things that inevitably go out of date.</p>
<p>The data output stored in NHSRdatasets won’t be changed and instead will have vignettes built to use the data and help explain and explore it.</p>
<section id="the-original-vignette" class="level2"><h2 class="anchored" data-anchor-id="the-original-vignette">The original vignette</h2>
<p>This vignette details why and how the <code>ons_mortality</code> dataset was created.</p>
<p>The data were pulled together from the weekly xls spreadsheets provided by the Office of National Statistics (ONS) from 2010 to 2019 for training purposes and is a static data set.</p>
<p>Data is released every Friday and includes provisionally registered deaths for England and Wales for:</p>
<ul>
<li>Total, all deaths</li>
<li>regions of usual residence</li>
<li>age bands (persons and for males/females)</li>
<li>by underlying cause ‘All respiratory diseases’ (the methodology has changed over the years, see the subsection for more information)</li>
</ul>
<section id="further-notes-taken-from-the-spreadsheet" class="level3"><h3 class="anchored" data-anchor-id="further-notes-taken-from-the-spreadsheet">Further notes taken from the spreadsheet:</h3>
<p>1 This average is based on the actual number of death registrations recorded for each corresponding week over the previous five years. Moveable public holidays, when register offices are closed, affect the number of registrations made in the published weeks and in the corresponding weeks in previous years.</p>
<p>2 Counts of deaths by underlying cause exclude deaths at age under 28 days.</p>
<p>3 Coding of deaths by underlying cause for the latest week is not yet complete.</p>
<p>4 Does not include deaths where age is either missing or not yet fully coded. For this reason counts of ‘Persons’, ‘Males’ and ‘Females’ may not sum to ‘Total Deaths, all ages’.</p>
<p>5 Does not include deaths of those resident outside England and Wales or those records where the place of residence is either missing or not yet fully coded. For this reason counts for “Deaths by Region of usual residence” may not sum to “Total deaths, all ages”.</p>
</section><section id="later-confirmation-of-deaths" class="level3"><h3 class="anchored" data-anchor-id="later-confirmation-of-deaths">Later confirmation of deaths</h3>
<p>Aggregate numbers of deaths are later confirmed and released in by <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/datasets/monthlyfiguresondeathsregisteredbyareaofusualresidence">ONS monthly</a>. Numbers are released at a lower geographical level to the weekly data.</p>
</section></section><section id="preparation-of-data" class="level2"><h2 class="anchored" data-anchor-id="preparation-of-data">Preparation of data</h2>
<p>In order to prepare this data for analysis the worksheet for weekly figures was extracted and the data was moved to long form and merged together over the available years. This was extracted in April 2020 when full previous years’ data was available.</p>
<p>The dataset contains:</p>
<ul>
<li>
<strong>category_1:</strong> character, containing the names of the groups for counts, e.g.&nbsp;“Total deaths”, “all ages”.</li>
<li>
<strong>category_2:</strong> character, subcategory of names of groups where necessary, e.g.&nbsp;details of region: “East”, details of age bands “15-44”.</li>
<li>
<strong>counts:</strong> numeric, numbers of deaths in whole numbers and average numbers with decimal points. To retain the integrity of the format this column data is left as character.</li>
<li>
<strong>date:</strong> date, format is yyyy-mm-dd; all dates are a Friday.</li>
<li>
<strong>week_no:</strong> integer, each week in a year is numbered sequentially.</li>
</ul></section><section id="source-and-licence-acknowledgement" class="level1"><h1>Source and licence acknowledgement</h1>
<p>This data has been made available through Office of National Statistics under the <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/">Open Government Licence</a>.</p>
<p>The main page for downloads is found on the <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/datasets/weeklyprovisionalfiguresondeathsregisteredinenglandandwales">ONS People Population and Community pages</a>.</p>
<section id="creating-the-dataset" class="level2"><h2 class="anchored" data-anchor-id="creating-the-dataset">Creating the dataset</h2>
<p>Spreadsheets are in xls format from 2010 to 2019.</p>
<p>Each week is released with a new file name listing the week number and all weeks for that year are included in the spreadsheet. Counts for weeks ahead are missing and listed as NA.</p>
<p>When a year has passed it is renamed to the year name and does not change.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 2019</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://www.ons.gov.uk/file?uri=%2fpeoplepopulationandcommunity%2fbirthsdeathsandmarriages%2fdeaths%2fdatasets%2fweeklyprovisionalfiguresondeathsregisteredinenglandandwales%2f2019/publishedweek522019.xls"</span>,</span>
<span>  destfile <span class="op">=</span> <span class="st">"2019Mortality.xls"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"wininet"</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2018</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://www.ons.gov.uk/file?uri=%2fpeoplepopulationandcommunity%2fbirthsdeathsandmarriages%2fdeaths%2fdatasets%2fweeklyprovisionalfiguresondeathsregisteredinenglandandwales%2f2018/publishedweek522018withupdatedrespiratoryrow.xls"</span>,</span>
<span>  destfile <span class="op">=</span> <span class="st">"2018Mortality.xls"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"wininet"</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2017</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://www.ons.gov.uk/file?uri=%2fpeoplepopulationandcommunity%2fbirthsdeathsandmarriages%2fdeaths%2fdatasets%2fweeklyprovisionalfiguresondeathsregisteredinenglandandwales%2f2017/publishedweek522017.xls"</span>,</span>
<span>  destfile <span class="op">=</span> <span class="st">"2017Mortality.xls"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"wininet"</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2016</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://www.ons.gov.uk/file?uri=%2fpeoplepopulationandcommunity%2fbirthsdeathsandmarriages%2fdeaths%2fdatasets%2fweeklyprovisionalfiguresondeathsregisteredinenglandandwales%2f2016/publishedweek522016.xls"</span>,</span>
<span>  destfile <span class="op">=</span> <span class="st">"2016Mortality.xls"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"wininet"</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2015</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://www.ons.gov.uk/file?uri=%2fpeoplepopulationandcommunity%2fbirthsdeathsandmarriages%2fdeaths%2fdatasets%2fweeklyprovisionalfiguresondeathsregisteredinenglandandwales%2f2015/publishedweek2015.xls"</span>,</span>
<span>  destfile <span class="op">=</span> <span class="st">"2015Mortality.xls"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"wininet"</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2014</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://www.ons.gov.uk/file?uri=%2fpeoplepopulationandcommunity%2fbirthsdeathsandmarriages%2fdeaths%2fdatasets%2fweeklyprovisionalfiguresondeathsregisteredinenglandandwales%2f2014/publishedweek2014.xls"</span>,</span>
<span>  destfile <span class="op">=</span> <span class="st">"2014Mortality.xls"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"wininet"</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2013</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://www.ons.gov.uk/file?uri=%2fpeoplepopulationandcommunity%2fbirthsdeathsandmarriages%2fdeaths%2fdatasets%2fweeklyprovisionalfiguresondeathsregisteredinenglandandwales%2f2013/publishedweek2013.xls"</span>,</span>
<span>  destfile <span class="op">=</span> <span class="st">"2013Mortality.xls"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"wininet"</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2012</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://www.ons.gov.uk/file?uri=%2fpeoplepopulationandcommunity%2fbirthsdeathsandmarriages%2fdeaths%2fdatasets%2fweeklyprovisionalfiguresondeathsregisteredinenglandandwales%2f2012/publishedweek2012.xls"</span>,</span>
<span>  destfile <span class="op">=</span> <span class="st">"2012Mortality.xls"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"wininet"</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2011</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://www.ons.gov.uk/file?uri=%2fpeoplepopulationandcommunity%2fbirthsdeathsandmarriages%2fdeaths%2fdatasets%2fweeklyprovisionalfiguresondeathsregisteredinenglandandwales%2f2011/publishedweek2011.xls"</span>,</span>
<span>  destfile <span class="op">=</span> <span class="st">"2011Mortality.xls"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"wininet"</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2010</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://www.ons.gov.uk/file?uri=%2fpeoplepopulationandcommunity%2fbirthsdeathsandmarriages%2fdeaths%2fdatasets%2fweeklyprovisionalfiguresondeathsregisteredinenglandandwales%2f2010/publishedweek2010.xls"</span>,</span>
<span>  destfile <span class="op">=</span> <span class="st">"2010Mortality.xls"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"wininet"</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="extracting-worksheets-to-csv" class="level2"><h2 class="anchored" data-anchor-id="extracting-worksheets-to-csv">Extracting worksheets to csv</h2>
<p>The data can be found in the worksheet called Weekly figures “date/year”. Other worksheets in spreadsheets 2010 to 2019 are:</p>
<ul>
<li>Contents</li>
<li>Information</li>
<li>Terms and conditions</li>
<li>Weekly figures <year></year>
</li>
<li>Related publications</li>
</ul>
<p>The following code finds the tab name and then creates a csv file for each tab/worksheet.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">files_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"working_files"</span>,</span>
<span>                         pattern <span class="op">=</span> <span class="st">"*.xls"</span>,</span>
<span>                         full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">read_then_csv</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sheet</span>, <span class="va">path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pathbase</span> <span class="op">&lt;-</span> <span class="va">path</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html">file_path_sans_ext</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">path</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">read_excel</span><span class="op">(</span>sheet <span class="op">=</span> <span class="va">sheet</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">write_csv</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">pathbase</span>, <span class="st">"-"</span>, <span class="va">sheet</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">files_list</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">files_list</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">path</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">excel_sheets</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">set_names</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">map</span><span class="op">(</span><span class="va">read_then_csv</span>, path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="loading-the-weekly-figure-worksheets" class="level2"><h2 class="anchored" data-anchor-id="loading-the-weekly-figure-worksheets">Loading the weekly figure worksheets</h2>
<p>From 2010 to 2015 the tab name was Weekly Figures then it changed capitalisation to Weekly figures.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">files_list_sheets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"working_files"</span>,</span>
<span>                         pattern <span class="op">=</span> <span class="st">"Weekly"</span>,</span>
<span>                         full.names <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                         <span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">files_list_sheets</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="fu">cols</span><span class="op">(</span>.default <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="format-data-functions" class="level2"><h2 class="anchored" data-anchor-id="format-data-functions">Format data functions</h2>
<p>Two functions were required to format the spreadsheets as there were changes to the layout from 2016.</p>
<p>Packages used:</p>
<ul>
<li>
<strong>janitor:</strong> a specific package for cleaning data from Excel used here to remove the blank lines and columns, convert Excel serial numbers to dates and to format all column headers by removing spaces in those header names and removing capitalisation.</li>
<li>
<strong>dplyr:</strong> specifically dplyr for data manipulation (already loaded earlier).</li>
<li>
<strong>tidyr:</strong> for pivoting data from wide to long.</li>
<li>
<strong>stringi:</strong> a package to works with strings and was used to find certain characters or words.</li>
<li>
<strong>lubridate:</strong> a package to work with dates and used here to format dates to the same format.</li>
</ul>
<section id="section" class="level3"><h3 class="anchored" data-anchor-id="section">2010 - 2015</h3>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringi.gagolewski.com/">stringi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Column names that are not related to data points to be removed. This is the same for all years' spreadsheets.</span></span>
<span><span class="co"># Note that single quotes are used for the categories as one sentence includes '' in the text (4). </span></span>
<span></span>
<span><span class="va">remove_lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'week over the previous five years1'</span>,</span>
<span>  <span class="st">'Deaths by underlying cause2,3'</span>,</span>
<span>  <span class="st">'Footnotes'</span>,</span>
<span>  <span class="st">'1 This average is based on the actual number of death registrations recorded for each corresponding week over the previous five years. Moveable public holidays, when register offices are closed, affect the number of registrations made in the published weeks and in the corresponding weeks in previous years.'</span>,</span>
<span>  <span class="st">'2 Counts of deaths by underlying cause exclude deaths at age under 28 days.'</span>,</span>
<span>  <span class="st">'3 Coding of deaths by underlying cause for the latest week is not yet complete.'</span>,</span>
<span>  <span class="st">"4Does not include deaths where age is either missing or not yet fully coded. For this reason counts of 'Persons', 'Males' and 'Females' may not sum to 'Total Deaths, all ages'."</span>,</span>
<span>  <span class="st">'5 Does not include deaths of those resident outside England and Wales or those records where the place of residence is either missing or not yet fully coded. For this reason counts for "Deaths by Region of usual residence" may not sum to "Total deaths, all ages".'</span>,</span>
<span>  <span class="st">'Source: Office for National Statistics'</span>,</span>
<span>  <span class="st">'Deaths by age group'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">formatFunction</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="va">ONS</span> <span class="op">&lt;-</span> <span class="va">file</span> <span class="op">%&gt;%</span></span>
<span>  <span class="va">clean_names</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">remove_empty</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rows"</span>,<span class="st">"cols"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">contents</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">remove_lookup</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  </span>
<span>  <span class="co"># useful categories are found in the column contents but also include the footnote number</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Category <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">str_detect</span><span class="op">(</span><span class="va">contents</span>, <span class="st">"Region"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Region"</span>,</span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">str_detect</span><span class="op">(</span><span class="va">contents</span>, <span class="st">"Persons"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Persons"</span>,</span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">str_detect</span><span class="op">(</span><span class="va">contents</span>, <span class="st">"Females"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Females"</span>,</span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">str_detect</span><span class="op">(</span><span class="va">contents</span>, <span class="st">"Males"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Males"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">contents</span>, <span class="va">Category</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  </span>
<span>  <span class="co"># to ensure data like Persons, Males and Females </span></span>
<span>  <span class="fu">fill</span><span class="op">(</span><span class="va">Category</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  </span>
<span>  <span class="co"># categories with Persons, Males and Females in the original column do not correspond directly to data points (wide form data) so are removed by referring to str_detect to find the word</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">contents</span>, <span class="st">"Persons"</span><span class="op">)</span>,</span>
<span>         <span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">contents</span>, <span class="st">"Males"</span><span class="op">)</span>,</span>
<span>         <span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">contents</span>, <span class="st">"Females"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  </span>
<span>  <span class="co"># the two columns for Category and contents are merged to Categories to bring the Category column first. Some categories don't have subcategories and these are preceded by NA_ with this merge</span></span>
<span>  <span class="fu">unite</span><span class="op">(</span><span class="st">"Categories"</span>, <span class="va">Category</span>, <span class="va">contents</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Categories</span> <span class="op">!=</span> <span class="st">"Region_Deaths by Region of usual residence 5"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  </span>
<span>  <span class="co"># the NA_ is removed from some of the category names</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Categories <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">Categories</span>, <span class="st">"NA_"</span><span class="op">)</span> <span class="op">~</span> <span class="fu">str_replace</span><span class="op">(</span><span class="va">Categories</span>, <span class="st">"NA_"</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>                                <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">Categories</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Push date row to column names</span></span>
<span><span class="va">onsFormattedJanitor</span> <span class="op">&lt;-</span> <span class="fu">row_to_names</span><span class="op">(</span><span class="va">ONS</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># move data from wide to long form using pivot_longer</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">onsFormattedJanitor</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">`Week ended`</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"allDates"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  </span>
<span>  <span class="co"># some spreadsheets import with Excel serial numbers for dates and others as dates, janitor is used to correct this</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>realDate <span class="op">=</span> <span class="fu">dmy</span><span class="op">(</span><span class="va">allDates</span><span class="op">)</span>,</span>
<span>         ExcelSerialDate <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu">stri_length</span><span class="op">(</span><span class="va">allDates</span><span class="op">)</span> <span class="op">==</span> <span class="fl">5</span> <span class="op">~</span> <span class="fu">excel_numeric_to_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">allDates</span><span class="op">)</span>, date_system <span class="op">=</span> <span class="st">"modern"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         date <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">realDate</span><span class="op">)</span> <span class="op">~</span> <span class="va">ExcelSerialDate</span>,</span>
<span>                          <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">realDate</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">`Week ended`</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  </span>
<span>  <span class="co"># the week number is replaced as this was lost with the moving of dates to the column headers</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>week_no <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  </span>
<span>  <span class="co"># Category is a staging name as this is followed by a splitting of the column into category_1 and category_2</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>Category <span class="op">=</span> <span class="va">`Week ended`</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  </span>
<span>  <span class="co"># to split the columns there are various characters used as a split point ",", "-", and ":" in the respiratory category the version is denoted by "v"</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>category_1 <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">","</span><span class="op">)</span> <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fl">1</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">","</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                                <span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">":"</span><span class="op">)</span> <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fl">1</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">":"</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                                <span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"_"</span><span class="op">)</span> <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fl">1</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"_"</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                                <span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"respiratory"</span><span class="op">)</span>  <span class="op">~</span></span>
<span>                                  <span class="st">"All respiratory diseases (ICD-10 J00-J99) ICD-10"</span><span class="op">)</span>,</span>
<span>         category_2 <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">","</span><span class="op">)</span> <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">", "</span><span class="op">)</span> <span class="op">+</span><span class="fl">2</span>, <span class="fu">str_length</span><span class="op">(</span><span class="va">Category</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                <span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">":"</span><span class="op">)</span> <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">": "</span><span class="op">)</span> <span class="op">+</span><span class="fl">2</span>, <span class="fu">str_length</span><span class="op">(</span><span class="va">Category</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                <span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"_"</span><span class="op">)</span> <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"_"</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span>, <span class="fu">str_length</span><span class="op">(</span><span class="va">Category</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                <span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"respiratory"</span><span class="op">)</span>  <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"v"</span><span class="op">)</span>, <span class="fu">str_length</span><span class="op">(</span><span class="va">Category</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>         </span>
<span>         <span class="co"># the data for Total deaths: average of corresponding week over the previous 5 years is split over two cells in the spreasheet</span></span>
<span>         category_2 <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">category_2</span>,</span>
<span>                             <span class="st">"average of corresponding"</span> <span class="op">=</span> <span class="st">"average of same week over 5 years"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">category_1</span>,</span>
<span>         <span class="va">category_2</span>,</span>
<span>         <span class="va">counts</span>,</span>
<span>         <span class="va">date</span>,</span>
<span>         <span class="va">week_no</span></span>
<span>         <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  </span>
<span>  <span class="co"># 2011 requires this code to remove rows where there are no counts and because there are 2 rows relating to respiratory death numbers (see the Respiratory section) the previous methodology has been included in the spreadsheet with : for counts. This code does not affect other years' data/</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span>,</span>
<span>         <span class="va">counts</span> <span class="op">!=</span> <span class="st">":"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">fill</span><span class="op">(</span><span class="va">category_1</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Mortality2010</span> <span class="op">&lt;-</span> <span class="fu">formatFunction</span><span class="op">(</span><span class="va">`working_files/Weekly/2010Mortality-Weekly Figures 2010.csv`</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2011 has two lines relating to respiratory, v 2001 only has one data point and the rest of the year is 2010</span></span>
<span><span class="va">Mortality2011</span> <span class="op">&lt;-</span> <span class="fu">formatFunction</span><span class="op">(</span><span class="va">`working_files/Weekly/2011Mortality-Weekly Figures 2011.csv`</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>category_2 <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">category_2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">category_1</span> <span class="op">==</span> <span class="st">"All respiratory diseases (ICD-10 J00-J99) ICD-10"</span> <span class="op">~</span> <span class="st">"v 2010"</span>,</span>
<span>                                <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">category_2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Mortality2012</span> <span class="op">&lt;-</span> <span class="fu">formatFunction</span><span class="op">(</span><span class="va">`working_files/Weekly/2012Mortality-Weekly Figures 2012.csv`</span><span class="op">)</span></span>
<span><span class="va">Mortality2013</span> <span class="op">&lt;-</span> <span class="fu">formatFunction</span><span class="op">(</span><span class="va">`working_files/Weekly/2013Mortality-Weekly Figures 2013.csv`</span><span class="op">)</span></span>
<span><span class="va">Mortality2014</span> <span class="op">&lt;-</span> <span class="fu">formatFunction</span><span class="op">(</span><span class="va">`working_files/Weekly/2014Mortality-Weekly Figures 2014.csv`</span><span class="op">)</span></span>
<span><span class="va">Mortality2015</span> <span class="op">&lt;-</span> <span class="fu">formatFunction</span><span class="op">(</span><span class="va">`working_files/Weekly/2015Mortality-Weekly Figures 2015.csv`</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="format-data-2016---2019" class="level4"><h4 class="anchored" data-anchor-id="format-data-2016---2019">Format data 2016 - 2019</h4>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">formatFunction2016</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">ONS</span> <span class="op">&lt;-</span> <span class="va">file</span> <span class="op">%&gt;%</span></span>
<span>    <span class="va">clean_names</span> <span class="op">%&gt;%</span></span>
<span>    </span>
<span>    <span class="co"># An extra column has been added for region codes (not included in the dataset) meaning contents are now found in the janitor generated column name x2</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>x2 <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">~</span> <span class="va">contents</span>,</span>
<span>                              <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">x2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">remove_empty</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rows"</span>,<span class="st">"cols"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">contents</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">x2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">remove_lookup</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    </span>
<span>    <span class="co"># Region has changed to region</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Category <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x3</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">str_detect</span><span class="op">(</span><span class="va">x2</span>, <span class="st">"region"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Region"</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x3</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">str_detect</span><span class="op">(</span><span class="va">x2</span>, <span class="st">"Persons"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Persons"</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x3</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">str_detect</span><span class="op">(</span><span class="va">x2</span>, <span class="st">"Females"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Females"</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x3</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">str_detect</span><span class="op">(</span><span class="va">x2</span>, <span class="st">"Males"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Males"</span>,</span>
<span>                                <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">x2</span>, <span class="va">Category</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">fill</span><span class="op">(</span><span class="va">Category</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">x2</span>, <span class="st">'Persons'</span><span class="op">)</span>,</span>
<span>           <span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">x2</span>, <span class="st">'Males'</span><span class="op">)</span>,</span>
<span>           <span class="op">!</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">x2</span>, <span class="st">'Females'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">unite</span><span class="op">(</span><span class="st">"Categories"</span>, <span class="va">Category</span>, <span class="va">x2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Categories</span> <span class="op">!=</span> <span class="st">'Region_Deaths by Region of usual residence 5'</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Categories <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">Categories</span>, <span class="st">"NA_"</span><span class="op">)</span> <span class="op">~</span> <span class="fu">str_replace</span><span class="op">(</span><span class="va">Categories</span>, <span class="st">"NA_"</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>                                  <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">Categories</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Push date row to column names</span></span>
<span>  <span class="va">onsFormattedJanitor</span> <span class="op">&lt;-</span> <span class="fu">row_to_names</span><span class="op">(</span><span class="va">ONS</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># move data from wide to long form using pivot_longer</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">onsFormattedJanitor</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">`Week ended`</span>,</span>
<span>                 names_to <span class="op">=</span> <span class="st">"allDates"</span>,</span>
<span>                 values_to <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>realDate <span class="op">=</span> <span class="fu">dmy</span><span class="op">(</span><span class="va">allDates</span><span class="op">)</span>,</span>
<span>           ExcelSerialDate <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu">stri_length</span><span class="op">(</span><span class="va">allDates</span><span class="op">)</span> <span class="op">==</span> <span class="fl">5</span> <span class="op">~</span> <span class="fu">excel_numeric_to_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">allDates</span><span class="op">)</span>, date_system <span class="op">=</span> <span class="st">"modern"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           date <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">realDate</span><span class="op">)</span> <span class="op">~</span> <span class="va">ExcelSerialDate</span>,</span>
<span>                            <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">realDate</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">`Week ended`</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>week_no <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">rename</span><span class="op">(</span>Category <span class="op">=</span> <span class="va">`Week ended`</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>category_1 <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">","</span><span class="op">)</span> <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fl">1</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">","</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                                <span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">":"</span><span class="op">)</span> <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fl">1</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">":"</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                                <span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"_"</span><span class="op">)</span> <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fl">1</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"_"</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                                <span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"respiratory"</span><span class="op">)</span>  <span class="op">~</span></span>
<span>                                  <span class="st">"All respiratory diseases (ICD-10 J00-J99) ICD-10"</span><span class="op">)</span>,</span>
<span>         category_2 <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">","</span><span class="op">)</span> <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">", "</span><span class="op">)</span> <span class="op">+</span><span class="fl">2</span>, <span class="fu">str_length</span><span class="op">(</span><span class="va">Category</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                <span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">":"</span><span class="op">)</span> <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">": "</span><span class="op">)</span> <span class="op">+</span><span class="fl">2</span>, <span class="fu">str_length</span><span class="op">(</span><span class="va">Category</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                <span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"_"</span><span class="op">)</span> <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"_"</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span>, <span class="fu">str_length</span><span class="op">(</span><span class="va">Category</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                <span class="fu">str_detect</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"respiratory"</span><span class="op">)</span>  <span class="op">~</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Category</span>,<span class="fu">str_locate</span><span class="op">(</span><span class="va">Category</span>, <span class="st">"v"</span><span class="op">)</span>, <span class="fu">str_length</span><span class="op">(</span><span class="va">Category</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>         category_2 <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">category_2</span>,</span>
<span>                             <span class="st">"average of corresponding"</span> <span class="op">=</span> <span class="st">"average of same week over 5 years"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">category_1</span>,</span>
<span>           <span class="va">category_2</span>,</span>
<span>           <span class="va">counts</span>,</span>
<span>           <span class="va">date</span>,</span>
<span>           <span class="va">week_no</span></span>
<span>    <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">Mortality2016</span> <span class="op">&lt;-</span> <span class="fu">formatFunction2016</span><span class="op">(</span><span class="va">`working_files/Weekly/2016Mortality-Weekly figures 2016.csv`</span><span class="op">)</span></span>
<span><span class="va">Mortality2017</span> <span class="op">&lt;-</span> <span class="fu">formatFunction2016</span><span class="op">(</span><span class="va">`working_files/Weekly/2017Mortality-Weekly figures 2017.csv`</span><span class="op">)</span></span>
<span><span class="va">Mortality2018</span> <span class="op">&lt;-</span> <span class="fu">formatFunction2016</span><span class="op">(</span><span class="va">`working_files/Weekly/2018Mortality-Weekly figures 2018.csv`</span><span class="op">)</span></span>
<span><span class="va">Mortality2019</span> <span class="op">&lt;-</span> <span class="fu">formatFunction2016</span><span class="op">(</span><span class="va">`working_files/Weekly/2019Mortality-Weekly figures 2019.csv`</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section></section><section id="bind-together" class="level2"><h2 class="anchored" data-anchor-id="bind-together">Bind together</h2>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ons_mortality</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>                      <span class="va">Mortality2010</span>,</span>
<span>                      <span class="va">Mortality2011</span>,</span>
<span>                      <span class="va">Mortality2012</span>,</span>
<span>                      <span class="va">Mortality2013</span>,</span>
<span>                      <span class="va">Mortality2014</span>,</span>
<span>                      <span class="va">Mortality2015</span>,</span>
<span>                      <span class="va">Mortality2016</span>,</span>
<span>                      <span class="va">Mortality2017</span>,</span>
<span>                      <span class="va">Mortality2018</span>,</span>
<span>                      <span class="va">Mortality2019</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="load-the-data" class="level2"><h2 class="anchored" data-anchor-id="load-the-data">Load the data</h2>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nhs-r-community/NHSRdatasets">NHSRdatasets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"ons_mortality"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="respiratory" class="level2"><h2 class="anchored" data-anchor-id="respiratory">Respiratory</h2>
<p>Deaths by underlying cause of respiratory diseases All respiratory diseases (ICD-10 J00-J99) appear as:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ons_mortality</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">category_1</span>, <span class="va">category_2</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">category_1</span>, <span class="va">category_2</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">category_1</span> <span class="op">==</span> <span class="st">'All respiratory diseases (ICD-10 J00-J99) ICD-10'</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notes from the spreadsheets in relation to these methodology changes:</p>
<section id="section-1" class="level3"><h3 class="anchored" data-anchor-id="section-1">2011</h3>
<ul>
<li>Respiratory deaths for 2011 are coded to the new version of ICD-10 while for 2010 they are coded to the previous version. Week 1 2011 has been coded to both versions to give an indication of the impact of the change.</li>
</ul></section><section id="section-2" class="level3"><h3 class="anchored" data-anchor-id="section-2">2014</h3>
<ul>
<li><p>For deaths registered from January 2014, cause of death is coded to the ICD-10 classification using IRIS software. Further information about the implementation of the software is available on the ONS website.</p></li>
<li><p>All deaths registered in week 2 were dual-coded using both ICD-10 v2010 (NCHS) and ICD-10 v2013 (IRIS). An information note providing the preliminary findings on the impact of the implementation of IRIS software for ICD-10 cause of death coding on mortality statistics in England and Wales is available on the ONS website.</p></li>
</ul></section><section id="section-3" class="level3"><h3 class="anchored" data-anchor-id="section-3">2015</h3>
<ul>
<li>For deaths registered from January 2014, cause of death is coded to the ICD-10 classification using IRIS software. Further information about the <a href="https://webarchive.nationalarchives.gov.uk/20160106020045/http://www.ons.gov.uk/ons/guide-method/user-guidance/health-and-life-events/Changes-to-cause-of-death-coding-in-England-and-Wales/index.html">implementation of the software</a> is available on the ONS website.</li>
</ul></section></section><section id="age-bands" class="level2"><h2 class="anchored" data-anchor-id="age-bands">Age bands</h2>
<p>Numbers are provided for categories: Persons, Females and Males.</p>
<p>As detailed in the notes, if the age is missing or not coded at the time of release then the counts of ‘Persons’, ‘Males’ and ‘Females’ may not sum to ‘Total Deaths, all ages’.</p>
<p>Note that these age bands were changed in 2020 releases.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ons_mortality</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">category_1</span>, <span class="va">category_2</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">category_1</span>, <span class="va">category_2</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">category_1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Persons'</span>,<span class="st">'Females'</span>,<span class="st">'Males'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="remove-working_files-folder" class="level2"><h2 class="anchored" data-anchor-id="remove-working_files-folder">Remove working_files folder</h2>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span><span class="op">(</span><span class="st">"working_files"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="citations" class="level1"><h1>Citations</h1>
<p>The data used to build the mortality dataset in this package is released under © Crown copyright and is free to use under the terms of the Open Government Licence. Any subsequent use should include a source accreditation to ONS - Source: Office for National Statistics licensed under the Open Government Licence.</p>


</section><a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/">CC0 1.0</a></div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/nhsrcommunity\.com\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>2025 NHS-R Community ∙ Made with <a href="https://quarto.org/"><img src="https://quarto.org/quarto.png" class="img-fluid" alt="Quarto logo blue round circle with a cross within the circumference" width="65"></a></p>
</div>   
    <div class="nav-footer-center">
<p><a href="https://fosstodon.org/@NHSrCommunity" aria-label="Go to NHSR's Fosstodon page" title="mastodon" target="_blank" rel="noopener"> <i class="link-dark me-1" aria-hidden="true"></i> <i class="fa-brands fa-mastodon" aria-label="mastodon"></i></a> <a href="https://bsky.app/profile/nhsrcommunity.bsky.social" aria-label="Go to NHSR's Bluesky page" title="bluesky" target="_blank" rel="noopener"> <i class="link-dark me-1" aria-hidden="true"></i> <iconify-icon role="img" inline="" icon="fa6-brands:bluesky" aria-label="Icon bluesky from fa6-brands Iconify.design set." title="Icon bluesky from fa6-brands Iconify.design set."></iconify-icon></a> <a href="https://github.com/nhs-r-community" aria-label="Go to NHSR's GitHub" title="github" target="_blank" rel="noopener"> <i class="link-dark me-1" aria-hidden="true"></i> <i class="fa-brands fa-github" aria-label="github"></i></a> <a href="https://soundcloud.com/nhs-r-community" aria-label="Go to NHSR's SoundCloud" title="soundcloud" target="_blank" rel="noopener"> <i class="link-dark me-1" aria-hidden="true"></i> <i class="fa-brands fa-soundcloud" aria-label="soundcloud"></i></a> <a href="https://www.linkedin.com/in/nhs-r-community-2555a6282/" aria-label="Go to NHSR's LinkedIn" title="LinkedIn" target="_blank" rel="noopener"> <i class="link-dark me-1" aria-hidden="true"></i> <i class="fa-brands fa-linkedin" aria-label="linkedin"></i></a></p>
<div class="toc-actions"><ul><li><a href="https://github.com/nhs-r-community/nhs-r-community/edit/main/blog/building-the-ons-mortality-dataset.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/nhs-r-community/nhs-r-community/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="../accessibility.html">
<p>Accessibility</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../ts-and-cs.html">
<p>Terms and Conditions</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../contact.html">
<p>Contact</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../licence.html">
<p>Licence</p>
</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="../blog/index.xml">
      <i class="bi bi-rss" role="img" aria-label="RSS blog feed">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>